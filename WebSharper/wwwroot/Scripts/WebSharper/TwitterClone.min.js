(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;b=a.WebSharper=a.WebSharper||{};c=b.TweetProps=b.TweetProps||{};d=b.Client=b.Client||{};e=b.TweetPushProcess=b.TweetPushProcess||{};f=a.TwitterClone_JsonEncoder=a.TwitterClone_JsonEncoder||{};g=a.TwitterClone_Templates=a.TwitterClone_Templates||{};h=a.TwitterClone_JsonDecoder=a.TwitterClone_JsonDecoder||{};i=b&&b.Strings;j=a.IntelliFactory;k=j&&j.Runtime;l=b&&b.Utils;m=a.console;n=b&&b.Concurrency;o=b&&b.Remoting;p=o&&o.AjaxRemotingProvider;q=a.JSON;r=b&&b.Arrays;s=b&&b.UI;t=s&&s.Var$1;u=b&&b.JavaScript;v=u&&u.Promise;w=b&&b.AspNetCore;x=w&&w.WebSocket;y=x&&x.Client;z=y&&y.WithEncoding;A=s&&s.Templating;B=A&&A.Runtime;C=B&&B.Server;D=C&&C.ProviderBuilder;E=C&&C.Handler;F=C&&C.TemplateInstance;G=s&&s.Doc;H=s&&s.AttrProxy;I=s&&s.Client;J=I&&I.Templates;K=b&&b.ClientSideJson;L=K&&K.Provider;c.New=function(M,N){return{username:M,content:N};};d.Twitter$278$23=function(M,N){return function(O){var P,Q,R,S,T;P=O.Vars.Hole("tweetid").$1.Get();Q="\""+i.Join("\",\"",i.SplitChars(O.Vars.Hole("retweettags").$1.Get(),[","],0))+"\"";R="\""+i.Join("\",\"",i.SplitChars(O.Vars.Hole("retweetmentions").$1.Get(),[","],0))+"\"";S=((((k.Curried(function(U,V,W,X){return U("{\"tweetId\": \""+l.toSafe(V)+"\", \"tag\": ["+l.toSafe(W)+"], \"mention\": ["+l.toSafe(X)+"]}");},4))(a.id))(P))(Q))(R);m.log(S);n.StartImmediate((T=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoReTweet:-984731262",[S]),function(U){var V,W;M.Set(U);W=q.parse(U);if(W.status==="success"){try{V=W.content;}catch(X){V=[];}N.$0.Post({$:0,$0:r.get(V,0).userId,$1:r.get(V,0).tweetId});return n.Zero();}else return n.Zero();});})),null);};};d.Twitter$257$21=function(M,N){return function(O){var P,Q,R,S,T;P=O.Vars.Hole("tweetcontent").$1.Get();Q="\""+i.Join("\",\"",i.SplitChars(O.Vars.Hole("tweettags").$1.Get(),[","],0))+"\"";R="\""+i.Join("\",\"",i.SplitChars(O.Vars.Hole("tweetmentions").$1.Get(),[","],0))+"\"";S=((((k.Curried(function(U,V,W,X){return U("{\"content\": \""+l.toSafe(V)+"\", \"tag\": ["+l.toSafe(W)+"], \"mention\": ["+l.toSafe(X)+"]}");},4))(a.id))(P))(Q))(R);m.log(S);n.StartImmediate((T=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoTweet:-984731262",[S]),function(U){var V,W;M.Set(U);W=q.parse(U);if(W.status==="success"){try{V=W.content;}catch(X){V=[];}N.$0.Post({$:0,$0:r.get(V,0).userId,$1:r.get(V,0).tweetId});return n.Zero();}else return n.Zero();});})),null);};};d.Twitter=function(M){var N,O,P,Q,R,S,T,U,V,W;N=t.Create$1("");O=null;v.OfAsync((P=null,n.Delay(function(){return z.ConnectStateful(function(X){return q.stringify((f.j())(X));},function(X){return(h.j())(q.parse(X));},M,function(){var X;X=null;return n.Delay(function(){return n.Return([0,function(Y){return function(Z){var _0;_0=null;return n.Delay(function(){var _1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc;if(Z.$==0){bc=Z.$0.$0;m.log(bc);try{_4=q.parse(bc).content;}catch(bd){_4=[];}_3=(_5=self.document.getElementById("tweetsDemoPanel"),_6=self.document.createElement("li"),_6.setAttribute("class","list-group-item fs-6 fw-light"),_6.appendChild(self.document.createTextNode(r.get(_4,0).tweetId)),_7=self.document.createElement("li"),_7.setAttribute("class","list-group-item fs-6 fw-light"),_7.appendChild(self.document.createTextNode(r.get(_4,0).timestamp)),_8=self.document.createElement("ul"),_8.setAttribute("class","list-group list-group-flush"),_8.appendChild(_6),_8.appendChild(_7),_9=self.document.createElement("div"),_9.setAttribute("class","card-footer"),_9.appendChild(_8),_=self.document.createElement("h5"),_.setAttribute("class","card-title"),_.appendChild(self.document.createTextNode(r.get(_4,0).userId)),$=self.document.createElement("p"),$.setAttribute("class","card-text"),$.appendChild(self.document.createTextNode(r.get(_4,0).text)),ba=self.document.createElement("div"),ba.setAttribute("class","card-body"),ba.appendChild(_),ba.appendChild($),bb=self.document.createElement("div"),bb.setAttribute("class","card"),bb.setAttribute("style","width: 40rem;"),bb.appendChild(ba),bb.appendChild(_9),_5.appendChild(bb),n.Zero());return n.Combine(_3,n.Delay(function(){return n.Return(Y+1);}));}else return Z.$==3?(m.log("WebSocket Connection Close"),n.Return(Y)):Z.$==1?(m.log("WebSocket Connection Error"),n.Return(Y)):(m.log("WebSocket Connection Open"),n.Return(Y));});};}]);});});}))).then(function(X){O={$:1,$0:X};});return(Q=(R=N.get_View(),(S=(T=(U=new D.New$1(),(U.h.push(E.EventQ2(U.k,"ontweet",function(){return U.i;},function(X){var Y,Z,_0,_1,_2;Y=X.Vars.Hole("tweetcontent").$1.Get();Z="\""+i.Join("\",\"",i.SplitChars(X.Vars.Hole("tweettags").$1.Get(),[","],0))+"\"";_0="\""+i.Join("\",\"",i.SplitChars(X.Vars.Hole("tweetmentions").$1.Get(),[","],0))+"\"";_1=((((k.Curried(function(_3,_4,_5,_6){return _3("{\"content\": \""+l.toSafe(_4)+"\", \"tag\": ["+l.toSafe(_5)+"], \"mention\": ["+l.toSafe(_6)+"]}");},4))(a.id))(Y))(Z))(_0);m.log(_1);n.StartImmediate((_2=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoTweet:-984731262",[_1]),function(_3){var _4,_5;N.Set(_3);_5=q.parse(_3);if(_5.status==="success"){try{_4=_5.content;}catch(_6){_4=[];}O.$0.Post({$:0,$0:r.get(_4,0).userId,$1:r.get(_4,0).tweetId});return n.Zero();}else return n.Zero();});})),null);})),U)),(T.h.push(E.EventQ2(T.k,"onretweet",function(){return T.i;},function(X){var Y,Z,_0,_1,_2;Y=X.Vars.Hole("tweetid").$1.Get();Z="\""+i.Join("\",\"",i.SplitChars(X.Vars.Hole("retweettags").$1.Get(),[","],0))+"\"";_0="\""+i.Join("\",\"",i.SplitChars(X.Vars.Hole("retweetmentions").$1.Get(),[","],0))+"\"";_1=((((k.Curried(function(_3,_4,_5,_6){return _3("{\"tweetId\": \""+l.toSafe(_4)+"\", \"tag\": ["+l.toSafe(_5)+"], \"mention\": ["+l.toSafe(_6)+"]}");},4))(a.id))(Y))(Z))(_0);m.log(_1);n.StartImmediate((_2=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoReTweet:-984731262",[_1]),function(_3){var _4,_5;N.Set(_3);_5=q.parse(_3);if(_5.status==="success"){try{_4=_5.content;}catch(_6){_4=[];}O.$0.Post({$:0,$0:r.get(_4,0).userId,$1:r.get(_4,0).tweetId});return n.Zero();}else return n.Zero();});})),null);})),T)),(S.h.push({$:2,$0:"result",$1:R}),S))),(V=E.CompleteHoles(Q.k,Q.h,[["tweetcontent",0],["tweettags",0],["tweetmentions",0],["tweetid",0],["retweettags",0],["retweetmentions",0]]),(W=new F.New(V[1],g.twitterform(V[0])),Q.i=W,W))).get_Doc();};d.Account$162$24=function(){return function(M){var N,O;N=M.Vars.Hole("unfollowid").$1.Get();m.log(N);n.StartImmediate((O=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoUnfollow:-984731262",[N]),function(P){m.log(P);return n.Zero();});})),null);};};d.Account$152$22=function(){return function(M){var N,O;N=M.Vars.Hole("followid").$1.Get();m.log(N);n.StartImmediate((O=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoFollow:-984731262",[N]),function(P){m.log(P);return n.Zero();});})),null);};};d.Account=function(){var M,N,O,P,Q;t.Create$1("");return(M=(N=(O=new D.New$1(),(O.h.push(E.EventQ2(O.k,"onfollow",function(){return O.i;},function(R){var S,T;S=R.Vars.Hole("followid").$1.Get();m.log(S);n.StartImmediate((T=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoFollow:-984731262",[S]),function(U){m.log(U);return n.Zero();});})),null);})),O)),(N.h.push(E.EventQ2(N.k,"onunfollow",function(){return N.i;},function(R){var S,T;S=R.Vars.Hole("unfollowid").$1.Get();m.log(S);n.StartImmediate((T=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoUnfollow:-984731262",[S]),function(U){m.log(U);return n.Zero();});})),null);})),N)),(P=E.CompleteHoles(M.k,M.h,[["followid",0],["unfollowid",0]]),(Q=new F.New(P[1],g.accountform(P[0])),M.i=Q,Q))).get_Doc();};d.Register$131$24=function(){return function(M){var N,O,P,Q,R;N=M.Vars.Hole("registerusername").$1.Get();O=M.Vars.Hole("registeruserpass").$1.Get();P=M.Vars.Hole("registeruseremail").$1.Get();Q=(((k.Curried3(function(S,T,U){return S("{\"email\": \""+l.toSafe(T)+"\", \"nickName\": \""+l.toSafe(U)+"\"}");}))(a.id))(P))(N);m.log(N+" : "+O+" : "+P);n.StartImmediate((R=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoRegister:-1072114517",[N,O,Q]),function(S){return q.parse(S).status==="success"?(self.location.replace("/"),n.Zero()):n.Zero();});})),null);};};d.Register=function(){var M,N,O,P;t.Create$1("");return(M=(N=new D.New$1(),(N.h.push(E.EventQ2(N.k,"onregister",function(){return N.i;},function(Q){var R,S,T,U,V;R=Q.Vars.Hole("registerusername").$1.Get();S=Q.Vars.Hole("registeruserpass").$1.Get();T=Q.Vars.Hole("registeruseremail").$1.Get();U=(((k.Curried3(function(W,X,Y){return W("{\"email\": \""+l.toSafe(X)+"\", \"nickName\": \""+l.toSafe(Y)+"\"}");}))(a.id))(T))(R);m.log(R+" : "+S+" : "+T);n.StartImmediate((V=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoRegister:-1072114517",[R,S,U]),function(W){return q.parse(W).status==="success"?(self.location.replace("/"),n.Zero()):n.Zero();});})),null);})),N)),(O=E.CompleteHoles(M.k,M.h,[["registerusername",0],["registeruseremail",0],["registeruserpass",0]]),(P=new F.New(O[1],g.loginblock(O[0])),M.i=P,P))).get_Doc();};d.Login$110$21=function(){return function(M){var N,O,P;N=M.Vars.Hole("inputusername").$1.Get();O=M.Vars.Hole("inputuserpass").$1.Get();m.log(N+" : "+O);n.StartImmediate((P=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoLogin:1450536541",[N,O]),function(Q){var R;R=q.parse(Q).status;m.log(R);return R==="success"?(m.log("111"),self.location.replace("/"),n.Zero()):n.Zero();});})),null);};};d.Login=function(){var M,N,O,P;return(M=(N=new D.New$1(),(N.h.push(E.EventQ2(N.k,"onlogin",function(){return N.i;},function(Q){var R,S,T;R=Q.Vars.Hole("inputusername").$1.Get();S=Q.Vars.Hole("inputuserpass").$1.Get();m.log(R+" : "+S);n.StartImmediate((T=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoLogin:1450536541",[R,S]),function(U){var V;V=q.parse(U).status;m.log(V);return V==="success"?(m.log("111"),self.location.replace("/"),n.Zero()):n.Zero();});})),null);})),N)),(O=E.CompleteHoles(M.k,M.h,[["inputusername",0],["inputuserpass",0]]),(P=new F.New(O[1],g.loginblock$1(O[0])),M.i=P,P))).get_Doc();};d.Test=function(){var M,N;M=G.Input([],t.Create$1(""));N=G.Element("div",[H.Create("class","panel-default")],[G.Element("div",[H.Create("class","panel-body")],[M])]);J.LoadLocalTemplates("");G.RunById("main",N);};d.Db$76$22=function(){return function(){var M;n.StartImmediate((M=null,n.Delay(function(){(new p.New()).Send("TwitterClone:WebSharper.Server.DoDBInit:6",[]);return n.Zero();})),null);};};d.Db=function(){var M,N,O,P,Q;return(M=(N=(O=new D.New$1(),(O.h.push(E.EventQ2(O.k,"oninitdb",function(){return O.i;},function(){var R;n.StartImmediate((R=null,n.Delay(function(){(new p.New()).Send("TwitterClone:WebSharper.Server.DoDBInit:6",[]);return n.Zero();})),null);})),O)),(N.h.push({$:1,$0:"result",$1:"Sccess!"}),N)),(P=E.CompleteHoles(M.k,M.h,[["texttoreverse",0]]),(Q=new F.New(P[1],g.mainform(P[0])),M.i=Q,Q))).get_Doc();};d.guest$44$26=k.Curried3(function(M,N,O){var P;return n.Start((P=null,n.Delay(function(){m.log("login");self.location.replace("/welcome");return n.Return(null);})),null);});d.guest=function(){return G.Element("div",[H.Create("style","margin-bottom: 20px")],[G.Element("p",[H.Create("style","display: inline; margin: 0 10px 15px 0")],[G.TextNode("click here to log in:")]),G.Element("button",[H.Create("class","btn btn-primary mybtn"),H.HandlerImpl("click",function(){return function(){var M;return n.Start((M=null,n.Delay(function(){m.log("login");self.location.replace("/welcome");return n.Return(null);})),null);};})],[G.TextNode("login")])]);};d.LoggedInUser$29$26=k.Curried3(function(M,N,O){var P;return n.Start((P=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoLogout:1005739806",[]),function(){self.location.replace("/");return n.Return(null);});})),null);});d.LoggedInUser=function(){return G.Element("div",[H.Create("style","margin-bottom: 20px")],[G.Element("p",[H.Create("style","display: inline; margin: 0 10px 15px 0")],[G.TextNode("click here to log out:")]),G.Element("button",[H.Create("class","btn btn-primary mybtn"),H.HandlerImpl("click",function(){return function(){var M;return n.Start((M=null,n.Delay(function(){return n.Bind((new p.New()).Async("TwitterClone:WebSharper.Server.DoLogout:1005739806",[]),function(){self.location.replace("/");return n.Return(null);});})),null);};})],[G.TextNode("logout")])]);};e.ProcessBinding=function(M){var N,O,P,Q,R;N=null;v.OfAsync((O=null,n.Delay(function(){return z.ConnectStateful(function(S){return q.stringify((f.j())(S));},function(S){return(h.j())(q.parse(S));},M,function(){var S;S=null;return n.Delay(function(){return n.Return([0,function(T){return function(U){var V;V=null;return n.Delay(function(){var W,X,Y,Z;return U.$==0?n.Combine((W=U.$0.$0,(m.log(W),X=q.parse(W),Y=self.document.getElementById("tweetsDemoPanel"),Z=self.document.createElement("li"),Z.appendChild(self.document.createTextNode(X.text)),Z.setAttribute("class","list-group-item"),Y.appendChild(Z),n.Zero())),n.Delay(function(){return n.Return(T+1);})):U.$==3?(m.log("WebSocket Connection Close"),n.Return(T)):U.$==1?(m.log("WebSocket Connection Error"),n.Return(T)):(m.log("WebSocket Connection Open"),n.Return(T));});};}]);});});}))).then(function(S){N={$:1,$0:S};});return(P=new D.New$1(),(Q=E.CompleteHoles(P.k,P.h,[]),(R=new F.New(Q[1],g.twitterdemo(Q[0])),P.i=R,R))).get_Doc();};f.j=function(){return f._v?f._v:f._v=(L.EncodeUnion(void 0,{tweetId:0},[["Info",[["$0","userId",L.Id(),0],["$1","tweetId",L.Id(),0]]]]))();};g.twitterform=function(M){J.LoadLocalTemplates("twitter");return M?J.NamedTemplate("twitter",{$:1,$0:"twitterform"},M):void 0;};g.accountform=function(M){J.LoadLocalTemplates("account");return M?J.NamedTemplate("account",{$:1,$0:"accountform"},M):void 0;};g.loginblock=function(M){J.LoadLocalTemplates("register");return M?J.NamedTemplate("register",{$:1,$0:"loginblock"},M):void 0;};g.loginblock$1=function(M){J.LoadLocalTemplates("login");return M?J.NamedTemplate("login",{$:1,$0:"loginblock"},M):void 0;};g.mainform=function(M){J.LoadLocalTemplates("main");return M?J.NamedTemplate("main",{$:1,$0:"mainform"},M):void 0;};g.twitterdemo=function(M){J.LoadLocalTemplates("twitterdemopanel");return M?J.NamedTemplate("twitterdemopanel",{$:1,$0:"twitterdemo"},M):void 0;};h.j=function(){return h._v?h._v:h._v=(L.DecodeUnion(void 0,"$",[[0,[["$0","Item",L.Id(),0]]]]))();};}(self));
